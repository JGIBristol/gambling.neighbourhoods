---
title: "DBSCAN_eps500"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{DBSCAN_eps500}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  echo = FALSE,
  eval = TRUE, # change to TRUE to produce the vignette and FALSE for the package build
  comment = "#>"
)
```


```{r setup, echo=FALSE, message=FALSE}
library(leaflet)
library(htmltools)
library(sp)
library(dplyr)
library(htmlwidgets)
# library(gambling.neighbourhoods)
library(devtools)
load_all()
```


# Gambling neighbourhoods using DBSCAN and eps=500m

## Load data
Load the geographical data (spatial points dataframe) containing the coordinates of gambling premises.
```{r load-data, echo=TRUE, message=FALSE}
library(devtools)
load_all()
xy <- readRDS("data/xy.rds")
```
## MinPts=2 with eps=500m 
Load dataframe with coordinates and cluster assignments
```{r dbscan_eps500_2, echo=TRUE, message=FALSE}
res2_dbscan_eps500 <- readRDS("results/dbscan_results_eps0.45_MinPts2.rds")
# Create a data frame from the spatial points
df2_dbscan_eps500 <- create_df(res2_dbscan_eps500,xy)
head(df2_dbscan_eps500)
dim(df2_dbscan_eps500)
```

Number of clusters (excluding noise):
```{r num-clusters-dbscan-eps500_2, message=FALSE}
k2_dbscan_eps500 <- length(unique(df2_dbscan_eps500$cluster)) - 1
k2_dbscan_eps500
```
Number of noise points:
```{r num-noise-dbscan-eps500_2, message=FALSE}
df2_dbscan_eps500_null <- create_df_null(df2_dbscan_eps500)
n_noise_dbscan_eps500_2 <- nrow(df2_dbscan_eps500_null)
n_noise_dbscan_eps500_2
``` 
Leaflet map for MinPts=2, eps=500m

```{r leaflet-map-k2, message=FALSE}
# Get the convex hulls for each cluster
cluster_hulls2 <- get_cluster_hulls(df2_dbscan_eps500)
# Create the leaflet map
map2 <-leaflet_map(cluster_hulls2, df2_dbscan_eps500, df2_dbscan_eps500_null)
# saveWidget(map2, file="results/map_MinPt2.html")
map2
```
## MinPts=3 with eps=500m
Load dataframe with coordinates and cluster assignments
```{r dbscan_eps500_3, message=FALSE}
res3_dbscan_eps500 <- readRDS("results/dbscan_results_eps0.45_MinPts3.rds")
# Create a data frame from the spatial points
df3_dbscan_eps500 <- create_df(res3_dbscan_eps500,xy)
head(df3_dbscan_eps500)
dim(df3_dbscan_eps500)
```
Number of clusters (excluding noise):
```{r num-clusters-dbscan-eps500_3, message=FALSE}
k3_dbscan_eps500 <- length(unique(df3_dbscan_eps500$cluster)) - 1
k3_dbscan_eps500
```
Number of noise points:
```{r num-noise-dbscan-eps500_3, message=FALSE}
df3_dbscan_eps500_null <- create_df_null(df3_dbscan_eps500)
n_noise_dbscan_eps500_3 <- nrow(df3_dbscan_eps500_null)
n_noise_dbscan_eps500_3
``` 
Leaflet map for MinPts=3, eps=500m

```{r leaflet-map-k3, message=FALSE}
# Get the convex hulls for each cluster
cluster_hulls3 <- get_cluster_hulls(df3_dbscan_eps500)
# Create the leaflet map
map3 <-leaflet_map(cluster_hulls3, df3_dbscan_eps500, df3_dbscan_eps500_null)
# saveWidget(map3, file="results/map_MinPt3.html")
map3
```

## MinPts=4 with eps=500m
Load dataframe with coordinates and cluster assignments
```{r dbscan_eps500_4, message=FALSE}
res4_dbscan_eps500 <- readRDS("results/dbscan_results_eps0.45_MinPts4.rds")
# Create a data frame from the spatial points
df4_dbscan_eps500 <- create_df(res4_dbscan_eps500,xy)
head(df4_dbscan_eps500)
dim(df4_dbscan_eps500)
```
Number of clusters (excluding noise):
```{r num-clusters-dbscan-eps500_4, message=FALSE}
k4_dbscan_eps500 <- length(unique(df4_dbscan_eps500$cluster)) - 1
k4_dbscan_eps500
```
Number of noise points:
```{r num-noise-dbscan-eps500_4, message=FALSE}
df4_dbscan_eps500_null <- create_df_null(df4_dbscan_eps500)
n_noise_dbscan_eps500_4 <- nrow(df4_dbscan_eps500_null)
n_noise_dbscan_eps500_4
``` 
Leaflet map for MinPts=4, eps=500m

```{r leaflet-map-k4, message=FALSE}
# Get the convex hulls for each cluster
cluster_hulls4 <- get_cluster_hulls(df4_dbscan_eps500)
# Create the leaflet map
map4 <-leaflet_map(cluster_hulls4, df4_dbscan_eps500, df4_dbscan_eps500_null)
# saveWidget(map4, file="results/map_MinPt4.html")
map4
```

## MinPts=5 with eps=500m
Load dataframe with coordinates and cluster assignments
```{r dbscan_eps500_5, message=FALSE}
res5_dbscan_eps500 <- readRDS("results/dbscan_results_eps500_MinPts5.rds")
# Create a data frame from the spatial points
df5_dbscan_eps500 <- create_df(res5_dbscan_eps500,xy)
head(df5_dbscan_eps500)
dim(df5_dbscan_eps500)
```
Number of clusters (excluding noise):
```{r num-clusters-dbscan-eps500_5, message=FALSE}
k5_dbscan_eps500 <- length(unique(df5_dbscan_eps500$cluster)) - 1
k5_dbscan_eps500
```
Number of noise points:   
```{r num-noise-dbscan-eps500_5, message=FALSE}
df5_dbscan_eps500_null <- create_df_null(df5_dbscan_eps500)
n_noise_dbscan_eps500_5 <- nrow(df5_dbscan_eps500_null)
n_noise_dbscan_eps500_5
``` 
Leaflet map for MinPts=5, eps=500m
```{r leaflet-map-dbscan-k5, message=FALSE}
# Get the convex hulls for each cluster 
cluster_hulls_dbscan_5 <- get_cluster_hulls(df5_dbscan_eps500)
# Create the leaflet map
map_dbscan_k5_eps500 <-leaflet_map(cluster_hulls_dbscan_5, df5_dbscan_eps500, df5_dbscan_eps500_null)
# saveWidget(map_dbscan_k5_eps500, file="results/map_DBSCAN_MinPt5_eps500.html")
map_dbscan_k5_eps500
``` 

## MinPts=10 with eps=500m
Load dataframe with coordinates and cluster assignments
```{r dbscan_eps500_10, message=FALSE}
res10_dbscan_eps500 <- readRDS("results/dbscan_results_eps500_MinPts10.rds")
# Create a data frame from the spatial points
df10_dbscan_eps500 <- create_df(res10_dbscan_eps500,xy)
head(df10_dbscan_eps500)
dim(df10_dbscan_eps500)
```
Number of clusters (excluding noise):
```{r num-clusters-dbscan-eps500_10, message=FALSE}
k10_dbscan_eps500 <- length(unique(df10_dbscan_eps500$cluster)) - 1
k10_dbscan_eps500
```
Number of noise points:
```{r num-noise-dbscan-eps500_10, message=FALSE}
df10_dbscan_eps500_null <- create_df_null(df10_dbscan_eps500)
n_noise_dbscan_eps500_10 <- nrow(df10_dbscan_eps500_null)
n_noise_dbscan_eps500_10
```
Leaflet map for MinPts=10, eps=500m 
```{r leaflet-map-dbscan-k10, message=FALSE}
# Get the convex hulls for each cluster 
cluster_hulls_dbscan_10 <- get_cluster_hulls(df10_dbscan_eps500)
# Create the leaflet map
map_dbscan_k10_eps500 <-leaflet_map(cluster_hulls_dbscan_10, df10_dbscan_eps500, df10_dbscan_eps500_null)
# saveWidget(map_dbscan_k10_eps500, file="results/map_DBSCAN_MinPt10_eps500.html")
map_dbscan_k10_eps500
```

## MinPts=15 with eps=500m
Load dataframe with coordinates and cluster assignments
```{r dbscan_eps500_15, message=FALSE}
res15_dbscan_eps500 <- readRDS("results/dbscan_results_eps500_MinPts15.rds")
# Create a data frame from the spatial points
df15_dbscan_eps500 <- create_df(res15_dbscan_eps500,xy)
head(df15_dbscan_eps500)
dim(df15_dbscan_eps500)
```   
Number of clusters (excluding noise):
```{r num-clusters-dbscan-eps500_15, message=FALSE}
k15_dbscan_eps500 <- length(unique(df15_dbscan_eps500$cluster)) - 1
k15_dbscan_eps500
```
Number of noise points:
```{r num-noise-dbscan-eps500_15, message=FALSE}
df15_dbscan_eps500_null <- create_df_null(df15_dbscan_eps500)
n_noise_dbscan_eps500_15 <- nrow(df15_dbscan_eps500_null)
n_noise_dbscan_eps500_15
```
No Leaflet map for MinPts=15, eps=500m

## MinPts=20 with eps=500m
Load dataframe with coordinates and cluster assignments
```{r dbscan_eps500_20, message=FALSE}
res20_dbscan_eps500 <- readRDS("results/dbscan_results_eps500_MinPts20.rds")
# Create a data frame from the spatial points
df20_dbscan_eps500 <- create_df(res20_dbscan_eps500,xy)
head(df20_dbscan_eps500)
dim(df20_dbscan_eps500)
```
Number of clusters (excluding noise):
```{r num-clusters-dbscan-eps500_20, message=FALSE}
k20_dbscan_eps500 <- length(unique(df20_dbscan_eps500$cluster)) - 1
k20_dbscan_eps500
```
Number of noise points:
```{r num-noise-dbscan-eps500_20, message=FALSE}
df20_dbscan_eps500_null <- create_df_null(df20_dbscan_eps500)
n_noise_dbscan_eps500_20 <- nrow(df20_dbscan_eps500_null)
n_noise_dbscan_eps500_20
```
No Leaflet map for MinPts=20, eps=500m
